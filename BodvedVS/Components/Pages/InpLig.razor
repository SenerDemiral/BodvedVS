@inject IScopedContainer SC
@inject ProtectedLocalStorage PLS
@inject IDataAccess db
@rendermode InteractiveServer
@inject NavigationManager Navigation
@* @attribute [StreamRendering(true)] *@
@page "/InpLig"

@* Lig girisleri ben yapacagim *@

<h3 style="background-color:gold">Son Sezon Turnuvaları</h3>

@if (ls != null)
{

    <table class="table-edit">
        <tr>
            <td colspan="4">
                <a href="InpRnkSzn">Oyuncu Başlangıç Rank</a>
            </td>
        </tr>
        @foreach (var r in ls)
        {
            <tr>
                <td class="text-center">@r.CCId</td>
                <td>@r.Ad</td>
                <td>
                    <a href="InpTkm/@r.CCId/@r.Ad">🏁</a>
                </td>
                <td>
                    <a href="InpFks/@r.CCId/@r.Ad">⏰</a>
                </td>
            </tr>
        }
    </table>
}
else
{
    <div>...</div>
}

@code {
    IEnumerable<LS>? ls;


    protected override async Task OnInitializedAsync()
    {
        //dnm = 0 ise son donem
        ls = db.LoadData<LS, dynamic>("select CCId,Ad from UI_LIG_SZN(0)", new { });
    }

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (firstRender)
        {
            if (!SC.IsOk)
            {
                UsrPLS lm = new();
                var toto = await PLS.GetAsync<UsrPLS>("pwd", "bodved");
                if (toto.Success)
                {
                    lm = toto.Value;
                }
                if(!SC.CheckLogin(lm.usrid, lm.usrpwd))
                    Navigation.NavigateTo("login");
            }
        }

        base.OnAfterRenderAsync(firstRender);
    }

    private sealed class LS
    {
        public int CCId { get; set; }
        public string Ad { get; set; }
    }

}
